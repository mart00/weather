#services:
#  server:
#    build:
#      context: .
#    ports:
#      - 9000:80
#    depends_on:
#      db:
#        condition: service_healthy
#    secrets:
#      - db-password
#    environment:
#      - PASSWORD_FILE_PATH=/run/secrets/db-password
#      - DB_HOST=db
#      - DB_NAME=weather
#      - DB_USER=root
#    volumes:
#      - ./src:/var/www/html
#
#  db:
#    image: mariadb
#    restart: always
#    secrets:
#      - db-password
#    volumes:
#      - db-data:/var/lib/mysql
#    environment:
#      - MARIADB_ROOT_PASSWORD_FILE=/run/secrets/db-password
#      - MARIADB_DATABASE=weather
#    expose:
#      - 3306
#    healthcheck:
#      test:
#        [
#          "CMD",
#          "/usr/local/bin/healthcheck.sh",
#          "--su-mysql",
#          "--connect",
#          "--innodb_initialized",
#        ]
#      interval: 10s
#      timeout: 5s
#      retries: 5
#
#  phpmyadmin:
#    image: phpmyadmin
#    ports:
#      - 8080:80
#    depends_on:
#      - db
#    environment:
#      - PMA_HOST=db
#
#volumes:
#  db-data:
#
#secrets:
#  db-password:
#    file: db/password.txt
services:
  server:
    build:
      context: .
    ports:
      - 9000:80
    depends_on:
      db:
        condition: service_healthy
    secrets:
      - db-password
    environment:
      - PASSWORD_FILE_PATH  
      - DB_HOST             
      - DB_NAME              
      - DB_USER              
    volumes:
      - ./src:/var/www/html

  db:
    image: mariadb
    restart: always
    secrets:
      - db-password
    volumes:
      - db-data:/var/lib/mysql
    environment:
      - MARIADB_ROOT_PASSWORD_FILE 
      - MARIADB_DATABASE              
    expose:
      - 3306
    healthcheck:
      test:
        [
          "CMD",
          "/usr/local/bin/healthcheck.sh",
          "--su-mysql",
          "--connect",
          "--innodb_initialized",
        ]
      interval: 10s
      timeout: 5s
      retries: 5

  phpmyadmin:
    image: phpmyadmin
    ports:
      - 8080:80
    depends_on:
      - db
    environment:
      - PMA_HOST=db

volumes:
  db-data:

secrets:
  db-password:
    file: db/password.txt  # This remains unchanged